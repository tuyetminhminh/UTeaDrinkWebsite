# üìö **GI·∫¢I TH√çCH CHI TI·∫æT V·ªÄ BI·∫æN M√îI TR∆Ø·ªúNG**

## üîç **V·∫§N ƒê·ªÄ B·∫†N V·ª™A G·∫∂P PH·∫¢I**

### **L·ªói: "Could not resolve placeholder 'CLOUDINARY_API_SECRET'"**

```
Caused by: java.lang.IllegalArgumentException: 
Could not resolve placeholder 'CLOUDINARY_API_SECRET' in value "${CLOUDINARY_API_SECRET}"
```

**Nguy√™n nh√¢n:**
- File `application.properties` c√≥ `cloudinary.api-secret=${CLOUDINARY_API_SECRET}`
- **KH√îNG c√≥ default value** sau d·∫•u `:`
- Spring Boot **Y√äU C·∫¶U** ph·∫£i c√≥ gi√° tr·ªã, n·∫øu kh√¥ng c√≥ env var th√¨ s·∫Ω b√°o l·ªói

---

## üéØ **C∆† CH·∫æ HO·∫†T ƒê·ªòNG C·ª¶A BI·∫æN M√îI TR∆Ø·ªúNG**

### **1. Spring Boot Property Placeholder**

Spring Boot s·ª≠ d·ª•ng c√∫ ph√°p `${VARIABLE_NAME:defaultValue}` trong `application.properties`:

```properties
# C√∫ ph√°p: ${ENV_VAR_NAME:defaultValue}
cloudinary.api-secret=${CLOUDINARY_API_SECRET:FEt7Kt4r9BWR-0e0Dx-jFBv_71M}
                       ^                       ^
                       |                       |
                    T√™n bi·∫øn           Gi√° tr·ªã m·∫∑c ƒë·ªãnh
                    m√¥i tr∆∞·ªùng         (n·∫øu kh√¥ng c√≥ env var)
```

### **2. Th·ª© t·ª± ∆∞u ti√™n (Priority)**

Spring Boot t√¨m gi√° tr·ªã theo th·ª© t·ª±:

```
1Ô∏è‚É£ System Environment Variables (cao nh·∫•t)
    ‚Üì
2Ô∏è‚É£ JVM System Properties (-D flags)
    ‚Üì
3Ô∏è‚É£ application.properties / application.yml
    ‚Üì
4Ô∏è‚É£ Default value (sau d·∫•u :)
```

**V√≠ d·ª• th·ª±c t·∫ø:**

```properties
# File: application.properties
cloudinary.api-secret=${CLOUDINARY_API_SECRET:default-secret-123}
```

**Tr∆∞·ªùng h·ª£p 1: C√ì bi·∫øn m√¥i tr∆∞·ªùng**
```bash
# Windows PowerShell
$env:CLOUDINARY_API_SECRET = "production-secret-456"
mvn spring-boot:run
```
‚û°Ô∏è **K·∫øt qu·∫£:** Spring Boot s·ª≠ d·ª•ng `production-secret-456`

**Tr∆∞·ªùng h·ª£p 2: KH√îNG c√≥ bi·∫øn m√¥i tr∆∞·ªùng**
```bash
mvn spring-boot:run
```
‚û°Ô∏è **K·∫øt qu·∫£:** Spring Boot s·ª≠ d·ª•ng `default-secret-123` (t·ª´ default value)

**Tr∆∞·ªùng h·ª£p 3: KH√îNG c√≥ bi·∫øn m√¥i tr∆∞·ªùng V√Ä KH√îNG c√≥ default value**
```properties
cloudinary.api-secret=${CLOUDINARY_API_SECRET}  # ‚ùå Kh√¥ng c√≥ default
```
```bash
mvn spring-boot:run
```
‚û°Ô∏è **K·∫øt qu·∫£:** ‚ùå **L·ªñI!** `Could not resolve placeholder 'CLOUDINARY_API_SECRET'`

---

## üí° **T·∫†I SAO SCRIPT `run-with-env.ps1` KH√îNG HO·∫†T ƒê·ªòNG?**

### **V·∫•n ƒë·ªÅ Process Isolation**

```powershell
# Script run-with-env.ps1
[Environment]::SetEnvironmentVariable("CLOUDINARY_API_SECRET", "abc123", "Process")
                                                                         ^^^^^^^^
                                                                         Ch·ªâ set cho
                                                                         PowerShell process hi·ªán t·∫°i
mvn spring-boot:run  # Maven ch·∫°y trong process CON ri√™ng
                     # ‚ùå KH√îNG k·∫ø th·ª´a bi·∫øn m√¥i tr∆∞·ªùng!
```

**Minh h·ªça:**

```
PowerShell Process (PID: 12345)
‚îú‚îÄ Bi·∫øn m√¥i tr∆∞·ªùng: CLOUDINARY_API_SECRET = "abc123" ‚úÖ
‚îÇ
‚îî‚îÄ Maven Process (PID: 67890)           üëà Process CON
   ‚îî‚îÄ Java Process (PID: 11111)         üëà Process CH√ÅU
      ‚îî‚îÄ Spring Boot ƒëang ch·∫°y
         ‚ùå KH√îNG th·∫•y bi·∫øn m√¥i tr∆∞·ªùng!
```

### **Gi·∫£i ph√°p ƒë√∫ng:**

**C√°ch 1: Set bi·∫øn ·ªü Process cha tr∆∞·ªõc khi ch·∫°y Maven**
```powershell
# Set bi·∫øn m√¥i tr∆∞·ªùng trong session hi·ªán t·∫°i
$env:CLOUDINARY_API_SECRET = "abc123"
$env:GOOGLE_CLIENT_SECRET = "xyz789"

# Ch·∫°y Maven (Maven s·∫Ω k·∫ø th·ª´a bi·∫øn)
mvn spring-boot:run
```

**C√°ch 2: Truy·ªÅn qua JVM System Properties**
```bash
mvn spring-boot:run -Dcloudinary.api-secret=abc123
```

**C√°ch 3: D√πng default values (c√°ch hi·ªán t·∫°i)**
```properties
cloudinary.api-secret=${CLOUDINARY_API_SECRET:FEt7Kt4r9BWR-0e0Dx-jFBv_71M}
                                             ^
                                             Default value - App v·∫´n ch·∫°y ƒë∆∞·ª£c!
```

---

## üîí **B·∫¢O M·∫¨T V·ªöI DEFAULT VALUES**

### **‚ùì "Th√™m default values th√¨ khi push l√™n Git c√≥ b√°o l·ªói kh√¥ng?"**

**C√¢u tr·∫£ l·ªùi: C√ì TH·ªÇ!**

GitHub Secret Scanning t√¨m ki·∫øm **patterns ƒë·∫∑c tr∆∞ng**:

| Secret Type | Pattern | Ph√°t hi·ªán? |
|-------------|---------|-----------|
| Database Password | `123456` | ‚ùå Kh√¥ng (qu√° ƒë∆°n gi·∫£n) |
| JWT Secret | `vG9p0mV9Z8q1Lw2rC3...` | ‚ö†Ô∏è C√≥ th·ªÉ (chu·ªói d√†i ng·∫´u nhi√™n) |
| Gmail App Password | `ravf kfon wtgd kkgc` | üü° Trung b√¨nh (16 k√Ω t·ª± c√≥ space) |
| Cloudinary API Secret | `FEt7Kt4r9BWR-0e0Dx...` | üî¥ Cao (pattern API key) |
| Google OAuth2 Client Secret | `GOCSPX-saJ7aFG51BK...` | üî¥ **R·∫§T CAO** (prefix `GOCSPX-`) |
| Google API Key | `AIzaSyAmZ3U1AyRD...` | üî¥ **CH·∫ÆC CH·∫ÆN** (prefix `AIzaSy`) |

### **‚öñÔ∏è Trade-off (ƒê√°nh ƒë·ªïi)**

**‚úÖ ∆Øu ƒëi·ªÉm c·ªßa default values:**
- App ch·∫°y ƒë∆∞·ª£c ngay (kh√¥ng c·∫ßn setup env vars)
- Thu·∫≠n ti·ªán cho dev local
- Kh√¥ng b·ªã l·ªói "Could not resolve placeholder"

**‚ùå Nh∆∞·ª£c ƒëi·ªÉm:**
- Secrets v·∫´n c√≥ trong Git history
- GitHub c√≥ th·ªÉ ph√°t hi·ªán v√† c·∫£nh b√°o
- Kh√¥ng ƒë·∫°t chu·∫©n b·∫£o m·∫≠t cao nh·∫•t

---

## üéØ **GI·∫¢I PH√ÅP T·ªêI ∆ØU**

### **Option 1: Gi·ªØ default values (Hi·ªán t·∫°i) - D√†nh cho Development**

```properties
# ‚ö†Ô∏è For local dev only. Production should use env vars without defaults.
cloudinary.api-secret=${CLOUDINARY_API_SECRET:FEt7Kt4r9BWR-0e0Dx-jFBv_71M}
```

**‚úÖ Ph√π h·ª£p khi:**
- ƒêang ph√°t tri·ªÉn local
- Mu·ªën ch·∫°y nhanh kh√¥ng setup ph·ª©c t·∫°p
- Ch∆∞a deploy production

**‚ùå KH√îNG ph√π h·ª£p khi:**
- Deploy l√™n production server
- C·∫ßn ƒë·∫°t chu·∫©n b·∫£o m·∫≠t cao
- Push l√™n GitHub public repo

---

### **Option 2: X√≥a default values - D√†nh cho Production**

```properties
# ‚ö†Ô∏è Production only. MUST set environment variables!
cloudinary.api-secret=${CLOUDINARY_API_SECRET}
```

**C√°ch setup trong Production:**

**A. Docker:**
```dockerfile
# Dockerfile
ENV CLOUDINARY_API_SECRET=your-secret-here
```

**B. Kubernetes:**
```yaml
# deployment.yaml
env:
  - name: CLOUDINARY_API_SECRET
    valueFrom:
      secretKeyRef:
        name: app-secrets
        key: cloudinary-secret
```

**C. Heroku:**
```bash
heroku config:set CLOUDINARY_API_SECRET=your-secret-here
```

**D. AWS Elastic Beanstalk:**
```
Configuration ‚Üí Software ‚Üí Environment properties
CLOUDINARY_API_SECRET = your-secret-here
```

---

### **Option 3: D√πng `.env` file v·ªõi `dotenv-java` (Khuy·∫øn ngh·ªã)**

**B∆∞·ªõc 1: Th√™m dependency v√†o `pom.xml`**

```xml
<dependency>
    <groupId>io.github.cdimascio</groupId>
    <artifactId>dotenv-java</artifactId>
    <version>3.0.0</version>
</dependency>
```

**B∆∞·ªõc 2: T·∫°o file `.env` (ƒë√£ c√≥ s·∫µn)**

```env
CLOUDINARY_API_SECRET=FEt7Kt4r9BWR-0e0Dx-jFBv_71M
GOOGLE_CLIENT_SECRET=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
```

**B∆∞·ªõc 3: Load `.env` trong `UteaApplication.java`**

```java
package net.codejava.utea;

import io.github.cdimascio.dotenv.Dotenv;
import org.springframework.boot.SpringApplication;
import org.springframework.boot.autoconfigure.SpringBootApplication;

@SpringBootApplication
public class UteaApplication {

    public static void main(String[] args) {
        // Load .env file (only if exists)
        Dotenv dotenv = Dotenv.configure()
                .ignoreIfMissing()  // Kh√¥ng l·ªói n·∫øu kh√¥ng c√≥ .env
                .load();
        
        // Set env vars cho Spring Boot
        dotenv.entries().forEach(entry -> 
            System.setProperty(entry.getKey(), entry.getValue())
        );
        
        SpringApplication.run(UteaApplication.class, args);
    }
}
```

**B∆∞·ªõc 4: X√≥a default values trong `application.properties`**

```properties
cloudinary.api-secret=${CLOUDINARY_API_SECRET}
```

**‚úÖ L·ª£i √≠ch:**
- ‚úÖ Kh√¥ng c·∫ßn setup env vars th·ªß c√¥ng
- ‚úÖ `.env` ƒë∆∞·ª£c gitignore (an to√†n)
- ‚úÖ Ho·∫°t ƒë·ªông c·∫£ local v√† production
- ‚úÖ ƒê·∫°t chu·∫©n b·∫£o m·∫≠t cao

---

## üìù **T√ìM T·∫ÆT - C√ÅC B∆Ø·ªöC TI·∫æP THEO**

### **Hi·ªán t·∫°i (ƒë√£ fix):**
‚úÖ ƒê√£ th√™m l·∫°i default values cho t·∫•t c·∫£ bi·∫øn b·∫Øt bu·ªôc
‚úÖ App ch·∫°y ƒë∆∞·ª£c m√† kh√¥ng c·∫ßn setup env vars
‚úÖ File `.env` v√† `.env.example` ƒë√£ t·∫°o s·∫µn

### **Khuy·∫øn ngh·ªã cho t∆∞∆°ng lai:**

**N·∫øu ch·ªâ ph√°t tri·ªÉn local:**
- Gi·ªØ nguy√™n default values (nh∆∞ hi·ªán t·∫°i)
- Ch·∫•p nh·∫≠n risk GitHub c√≥ th·ªÉ ph√°t hi·ªán

**N·∫øu chu·∫©n b·ªã deploy production:**
1. C√†i `dotenv-java` dependency
2. S·ª≠a `UteaApplication.java` ƒë·ªÉ load `.env`
3. X√≥a default values trong `application.properties`
4. Commit v√† push (an to√†n 100%)

---

## üöÄ **C√ÅCH CH·∫†Y ·ª®NG D·ª§NG NGAY B√ÇY GI·ªú**

```bash
cd UTeaDrinkWebsite
mvn spring-boot:run
```

‚û°Ô∏è **Ho·∫°t ƒë·ªông ngay!** (V√¨ ƒë√£ c√≥ default values)

---

## ‚ùì **FAQ**

**Q: T·∫°i sao kh√¥ng d√πng `System.getenv()` trong Java code?**

A: V√¨ c·∫ßn ph·∫£i inject v√†o Spring beans th√¥ng qua `@Value`, kh√¥ng n√™n truy c·∫≠p tr·ª±c ti·∫øp `System.getenv()`.

---

**Q: T√¥i c√≥ th·ªÉ d√πng `application-dev.properties` v√† `application-prod.properties` ri√™ng kh√¥ng?**

A: C√≥! ƒê√¢y l√† c√°ch t·ªët:

```properties
# application-dev.properties (c√≥ default values)
cloudinary.api-secret=${CLOUDINARY_API_SECRET:FEt7Kt4r9BWR-0e0Dx-jFBv_71M}

# application-prod.properties (kh√¥ng c√≥ default values)
cloudinary.api-secret=${CLOUDINARY_API_SECRET}
```

Ch·∫°y v·ªõi profile:
```bash
mvn spring-boot:run -Dspring.profiles.active=dev
mvn spring-boot:run -Dspring.profiles.active=prod
```

---

**Q: GitHub ƒë√£ ph√°t hi·ªán secrets c·ªßa t√¥i, ph·∫£i l√†m g√¨?**

A:
1. **Thu h·ªìi secrets ngay l·∫≠p t·ª©c** (t·∫°o m·ªõi)
2. **X√≥a secrets kh·ªèi Git history:**
   ```bash
   git filter-branch --force --index-filter \
   "git rm --cached --ignore-unmatch application.properties" \
   --prune-empty --tag-name-filter cat -- --all
   ```
3. **Force push:**
   ```bash
   git push origin --force --all
   ```

---

üéâ **Ch√∫c b·∫°n th√†nh c√¥ng!**


