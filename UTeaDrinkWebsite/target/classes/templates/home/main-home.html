<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8">
    <title>üçπ UTeaDrink - H∆∞∆°ng v·ªã t∆∞∆°i m√°t m·ªói ng√†y</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <style>
        /* ====== Design tokens: trung t√≠nh, nh·∫•n cam cho CTA/gi√° ====== */
        :root{
            --brand:#ff7b00; --brand-600:#e36d00;
            --ink:#111827; --muted:#6b7280; --card:#fff;
            --bg1:#f6f7f9; --bg2:#ffffff;
            --radius:18px; --shadow-sm:0 6px 16px rgba(0,0,0,.06); --shadow-md:0 12px 30px rgba(0,0,0,.10);
        }
        html{scroll-behavior:smooth}
        body{font-family:'Poppins','Segoe UI',system-ui; color:var(--ink); margin:0; background:linear-gradient(180deg,var(--bg1),var(--bg2))}
        /* N·∫øu header KH√îNG fixed, b·ªè class n√†y; n·∫øu v·∫´n c√≤n, √©p v·ªÅ 0 ƒë·ªÉ kh√¥ng b·ªã d∆∞ kho·∫£ng */
        .page-with-header{padding-top:0 !important}

        /* ===== HERO ===== */
        #heroCarousel{position:relative; height:72vh; min-height:460px; overflow:hidden}
        .hero-img{height:72vh; min-height:460px; width:100%; object-fit:cover}
        .hero-overlay{position:absolute; inset:0; background:linear-gradient(180deg,rgba(0,0,0,.35),rgba(0,0,0,.18) 35%,rgba(0,0,0,.55))}
        .carousel-caption{position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); max-width:860px; width:92%; text-align:center; z-index:2}
        .carousel-caption h1{font-size:clamp(28px,5vw,56px); color:#fff; font-weight:900}
        .carousel-caption p{color:#eef0f3; font-size:clamp(14px,2vw,19px)}
        .btn-hero{border:none; border-radius:999px; padding:12px 22px; font-weight:800; background:var(--brand); color:#fff; box-shadow:0 12px 26px rgba(255,123,0,.28)}
        .btn-hero:hover{background:var(--brand-600)}
        .btn-ghost{border-radius:999px; padding:12px 20px; font-weight:800; background:transparent; color:#fff; border:2px solid rgba(255,255,255,.7)}
        .btn-ghost:hover{background:rgba(255,255,255,.1)}
        .carousel-indicators [data-bs-target]{width:10px;height:10px;border-radius:50%}

        /* ===== INTRO ===== */
        #intro{background:#fff; border-radius:20px; padding:44px 28px; margin-top:34px; box-shadow:var(--shadow-sm)}
        #intro .intro-img{width:100%; max-width:520px; border-radius:16px; box-shadow:var(--shadow-md)}
        .section-title{font-weight:900; letter-spacing:.2px}
        .lead-muted{color:#4b5563}
        .feature-list{display:flex; flex-wrap:wrap; gap:10px; margin-top:10px}
        .feature-pill{background:#f3f4f6; color:#111; border:1px solid #e7e7e7; border-radius:999px; padding:8px 12px; font-weight:700}

        /* ===== FILTER BAR ===== */
        #products{padding-top:28px}
        .filter-bar{position:sticky; top:64px; z-index:10; margin:16px 0 10px; background:#fff; border:1px solid #eee; border-radius:14px; padding:10px 12px; box-shadow:var(--shadow-sm)}
        .category-bar{display:flex; gap:10px; flex-wrap:wrap}
        .chip{background:#f4f6f8; border:1px solid #e9ecef; color:#111; padding:8px 14px; border-radius:999px; text-decoration:none; font-weight:700}
        .chip:hover{background:#eef2f5}
        .chip.active{background:var(--brand); border-color:var(--brand); color:#fff}
        .search-wrap{position:relative; min-width:260px}
        .search-wrap input{width:100%; border:1px solid #e9ecef; border-radius:12px; padding:10px 12px 10px 36px}
        .search-wrap i{position:absolute; left:10px; top:50%; transform:translateY(-50%); color:#9aa1aa}

        /* ===== PRODUCT GRID ===== */
        .product-grid{max-width:1240px; margin:14px auto 20px; display:grid; grid-template-columns:repeat(auto-fill,minmax(240px,1fr)); gap:16px}
        .card-prod{background:var(--card); border-radius:16px; padding:12px; text-align:center; box-shadow:var(--shadow-sm); transition:transform .18s, box-shadow .18s}
        .card-prod:hover{transform:translateY(-3px); box-shadow:var(--shadow-md)}
        .card-img{aspect-ratio:4/5; border-radius:14px; overflow:hidden; background:#f5f5f6}
        .card-img img{width:100%; height:100%; object-fit:cover; display:block; transition:transform .35s}
        .card-prod:hover .card-img img{transform:scale(1.05)}
        .prod-name{font-weight:800; margin:10px 0 4px; color:#111; min-height:42px}
        .prod-desc{color:#6b7280; font-size:14px; min-height:40px; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden}
        .price{color:var(--brand); font-weight:900; font-size:18px}
        .btn-primaryx{background:var(--brand); color:#fff; border:none; border-radius:12px; padding:9px 14px; font-weight:800}
        .btn-primaryx:hover{background:var(--brand-600)}

        /* ===== PAGINATION ===== */
        .pagination .page-link{border:none; margin:0 4px; border-radius:10px; font-weight:700; color:#111}
        .pagination .page-link:hover{background:#f4f6f8}
        .pagination .active .page-link{background:var(--brand); color:#fff}

        /* ===== TESTIMONIALS (carousel 1 th·∫ª) ===== */
        #testimonials{ --per:3; --gap:20px; padding:28px 0 6px }
        @media (max-width: 991.98px){ #testimonials{ --per:2 } }
        @media (max-width: 575.98px){ #testimonials{ --per:1 } }
        .t-wrap{ position:relative; padding:0 54px } /* ch·ª´a ch·ªó cho n√∫t ƒëi·ªÅu h∆∞·ªõng */
        .t-viewport{ overflow:hidden }
        .t-track{
            display:grid;
            grid-auto-flow:column;
            grid-auto-columns: calc((100% - (var(--gap) * (var(--per) - 1))) / var(--per));
            gap:var(--gap);
            align-items:stretch;                 /* c√°c c·ªôt c√πng chi·ªÅu cao */
            will-change: transform;
            transition: transform .45s ease;
        }
        .t-card{
            background:#fff; border:1px solid #eaeaea; border-radius:18px;
            padding:22px; box-shadow:0 8px 24px rgba(16,24,40,.06);
            text-align:center; display:flex; flex-direction:column; /* chia khu */
        }
        .t-stars{ color:#ffb800; font-size:18px }
        .t-title{ font-weight:800; margin:10px 0 8px }
        .t-body{ color:#4b5563; flex:1; display:flex; align-items:center; justify-content:center; min-height:70px }
        .t-sep{ height:1px; background:#e5e7eb; width:62%; margin:12px auto 10px }
        .t-footer{ display:flex; align-items:center; justify-content:center; gap:8px; font-weight:700 }
        .t-nav{
            position:absolute; top:50%; transform:translateY(-50%);
            width:44px; height:44px; border-radius:999px; border:none;
            background:var(--brand); color:#fff;
            display:flex; align-items:center; justify-content:center;
            box-shadow:0 10px 24px rgba(255,123,0,.28); cursor:pointer; z-index:2;
        }
        .t-nav:hover{ background:var(--brand-600) }
        .t-nav[disabled]{ background:#e5e7eb; color:#94a3b8; box-shadow:none; cursor:not-allowed }
        .t-prev{ left:6px } .t-next{ right:6px }

        /* ===== CONTACT + MAP (gi·ªØ g·ªçn) ===== */
        .contact-card{background:#fff; border-radius:18px; padding:22px; box-shadow:var(--shadow-sm)}
        .locator-card{background:#fff; border-radius:18px; box-shadow:var(--shadow-sm); padding:18px}
        .store-search{position:relative; margin-bottom:12px}
        .store-search input{width:100%; border:1px solid #e9ecef; border-radius:12px; padding:10px 12px 10px 36px}
        .store-search i{position:absolute; left:10px; top:50%; transform:translateY(-50%); color:#9aa1aa}
        .store-item{border:1px solid #eee; border-radius:12px; padding:12px; margin-bottom:10px; cursor:pointer}
        .store-item.active{border-color:#ffd6ad; background:#fff8f1}
        .map-card iframe{width:100%; height:420px; border:0}
    </style>
</head>
<body><!-- KH√îNG d√πng class page-with-header ƒë·ªÉ tr√°nh d∆∞ kho·∫£ng -->

<!-- Header -->
<div th:replace="~{fragments/header-home :: siteHeader}"></div>

<!-- HERO -->
<section id="heroCarousel" class="carousel slide" data-bs-ride="carousel">
    <div class="carousel-indicators" th:if="${hasBanners}">
        <button type="button" data-bs-target="#heroCarousel"
                th:each="b,idx : ${banners}" th:data-bs-slide-to="${idx.index}"
                th:classappend="${idx.index == 0} ? ' active'"></button>
    </div>

    <div class="carousel-inner" th:if="${hasBanners}">
        <div class="carousel-item" th:each="b,idx : ${banners}" th:classappend="${idx.index == 0} ? ' active'">
            <img th:src="${b.imageUrl}" class="d-block w-100 hero-img" th:alt="${b.title ?: 'UTeaDrink Banner'}" loading="lazy">
            <div class="hero-overlay"></div>
            <div class="carousel-caption" th:if="${b.title}">
                <h1 th:text="${b.title}">UTeaDrink</h1>
                <p>H∆∞∆°ng v·ªã t∆∞∆°i m√°t ‚Äì NƒÉng l∆∞·ª£ng m·ªói ng√†y üåø</p>
                <div class="d-flex gap-2 justify-content-center">
                    <a href="#products" class="btn btn-hero">Xem menu</a>
                    <a th:href="@{/login}" class="btn btn-ghost">ƒê·∫∑t ngay</a>
                </div>
            </div>
        </div>
    </div>

    <div class="carousel-inner" th:if="${!hasBanners}">
        <div class="carousel-item active">
            <img src="https://res.cloudinary.com/dhmh2ekqy/image/upload/v1760047323/1-tuan-nen-uong-bao-nhieu-tra-sua-1000x690_slbfnn.jpg" class="d-block w-100 hero-img" alt="UTeaDrink">
            <div class="hero-overlay"></div>
            <div class="carousel-caption">
                <h1>UTeaDrink</h1>
                <p>H∆∞∆°ng v·ªã t∆∞∆°i m√°t ‚Äì NƒÉng l∆∞·ª£ng m·ªói ng√†y üåø</p>
                <div class="d-flex gap-2 justify-content-center">
                    <a href="#products" class="btn btn-hero">Xem menu</a>
                    <a th:href="@{/login}" class="btn btn-ghost">ƒê·∫∑t ngay</a>
                </div>
            </div>
        </div>
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
        <span class="carousel-control-prev-icon"></span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
        <span class="carousel-control-next-icon"></span>
    </button>
</section>

<!-- INTRO (vi·∫øt l·∫°i n·ªôi dung) -->
<section id="intro" class="container">
    <div class="row align-items-center justify-content-center gx-5">
        <div class="col-lg-6 text-center">
            <img src="https://res.cloudinary.com/dhmh2ekqy/image/upload/v1759979120/tra-sua-matcha_anwkom.jpg" alt="Tr√† s·ªØa matcha" class="intro-img">
        </div>
        <div class="col-lg-6 mt-4 mt-lg-0">
            <h3 class="section-title" style="color:var(--brand)">V·ªÅ UTeaDrink</h3>
            <p class="lead-muted">
                <strong>UTeaDrink</strong> l√† chu·ªói ƒë·ªì u·ªëng tr·ª±c tuy·∫øn hi·ªán ƒë·∫°i, k·∫øt h·ª£p c√¥ng th·ª©c chu·∫©n v·ªã v·ªõi
                tr·∫£i nghi·ªám ƒë·∫∑t h√†ng m∆∞·ª£t m√†. Ch√∫ng t√¥i ch·ªçn nguy√™n li·ªáu t∆∞∆°i m·ªói ng√†y v√† gi·ªØ tr·ªçn h∆∞∆°ng v·ªã t·ª± nhi√™n trong t·ª´ng ly.
            </p>
            <p class="lead-muted">
                S·ª© m·ªánh: <strong>‚ÄúT∆∞∆°i m·ªói ng√†y ‚Äì H·∫°nh ph√∫c t·ª´ h∆∞∆°ng v·ªã‚Äù</strong>. Cam k·∫øt ch·∫•t l∆∞·ª£ng ·ªïn ƒë·ªãnh, giao nhanh v√† minh b·∫°ch ngu·ªìn g·ªëc.
            </p>
            <div class="feature-list">
                <span class="feature-pill"><i class="bi bi-cup-hot"></i> Pha ch·∫ø chu·∫©n v·ªã</span>
                <span class="feature-pill"><i class="bi bi-truck"></i> Giao nhanh 30‚Äô</span>
                <span class="feature-pill"><i class="bi bi-shield-check"></i> An to√†n & r√µ ngu·ªìn g·ªëc</span>
            </div>
        </div>
    </div>
</section>

<!-- PRODUCTS -->
<section id="products" class="container">
    <div class="text-center">
        <h3 class="section-title">S·∫£n ph·∫©m</h3>
    </div>

    <div class="filter-bar d-flex flex-wrap align-items-center justify-content-between gap-2">
        <div class="category-bar" th:if="${categories}">
            <a th:href="@{/main-home(size=${size})} + ${anchor}" class="chip" th:classappend="${selectedCategoryId == null} ? ' active'">T·∫•t c·∫£</a>
            <a th:each="c : ${categories}"
               th:href="@{/main-home(categoryId=${c.id}, page=0, size=${size})} + ${anchor}"
               class="chip" th:classappend="${selectedCategoryId == c.id} ? ' active'"
               th:text="${c.name}">Danh m·ª•c</a>
        </div>
        <div class="search-wrap ms-auto">
            <i class="bi bi-search"></i>
            <input id="productSearch" type="text" placeholder="T√¨m nhanh theo t√™n/m√¥ t·∫£‚Ä¶">
        </div>
    </div>

    <div id="productGrid" class="product-grid" th:if="${products}">
        <article th:each="p : ${products}" class="card-prod"
                 th:attr="data-name=${p.name}, data-desc=${p.description}">
            <div class="card-img">
                <img th:src="${(p.images != null and !p.images.isEmpty()) ? p.images.get(0).url : '/images/no-image.png'}"
                     th:alt="${p.name}" loading="lazy">
            </div>
            <div class="prod-name" th:text="${p.name}">T√™n SP</div>
            <div class="prod-desc" th:text="${p.description}">M√¥ t·∫£ ng·∫Øn‚Ä¶</div>
            <div class="price" th:text="${#numbers.formatDecimal(p.basePrice, 0, 'COMMA', 0, 'POINT')} + ' ƒë'">0 ƒë</div>
            <a class="btn btn-primaryx w-100 mt-2" th:href="@{/login}"><i class="bi bi-bag-plus"></i> Th√™m v√†o gi·ªè </a>
        </article>
    </div>

    <div class="text-center text-muted py-4" th:if="${totalPages == 0}">
        Ch∆∞a c√≥ s·∫£n ph·∫©m ph√π h·ª£p.
    </div>

    <div class="d-flex justify-content-center mt-2" th:if="${totalPages > 1}">
        <nav aria-label="Product pagination">
            <ul class="pagination">
                <li class="page-item" th:classappend="${currentPage == 0} ? ' disabled'">
                    <a class="page-link"
                       th:href="${selectedCategoryId != null} ?
                 @{/main-home(categoryId=${selectedCategoryId}, page=${currentPage-1}, size=${size})} + ${anchor} :
                 @{/main-home(page=${currentPage-1}, size=${size})} + ${anchor}">
                        ¬´
                    </a>
                </li>
                <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages-1)}"
                    th:classappend="${i == currentPage} ? ' active'">
                    <a class="page-link" th:text="${i+1}"
                       th:href="${selectedCategoryId != null} ?
                 @{/main-home(categoryId=${selectedCategoryId}, page=${i}, size=${size})} + ${anchor} :
                 @{/main-home(page=${i}, size=${size})} + ${anchor}"></a>
                </li>
                <li class="page-item" th:classappend="${currentPage+1 >= totalPages} ? ' disabled'">
                    <a class="page-link"
                       th:href="${selectedCategoryId != null} ?
                 @{/main-home(categoryId=${selectedCategoryId}, page=${currentPage+1}, size=${size})} + ${anchor} :
                 @{/main-home(page=${currentPage+1}, size=${size})} + ${anchor}">
                        ¬ª
                    </a>
                </li>
            </ul>
        </nav>
    </div>
</section>

<!-- TESTIMONIALS -->
<section id="testimonials" class="container"
         th:if="${reviewCards != null && !#lists.isEmpty(reviewCards)}">
    <div class="text-center mb-3">
        <h3 class="section-title">Kh√°ch h√†ng ƒë√°nh gi√°</h3>
    </div>

    <div class="t-wrap">
        <button id="revPrev" class="t-nav t-prev" type="button" aria-label="Tr∆∞·ªõc">
            <i class="bi bi-chevron-left"></i>
        </button>

        <div id="revViewport" class="t-viewport">
            <div id="revTrack" class="t-track">
                <article class="t-card" th:each="rc : ${reviewCards}">
                    <div class="t-stars">
                        <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i><i class="bi bi-star-fill"></i>
                        <i class="bi bi-star-fill"></i>
                    </div>
                    <div class="t-title" th:text="${rc.productName}">T√™n s·∫£n ph·∫©m</div>
                    <div class="t-body">
                        <div th:text="${rc.content}">N·ªôi dung ƒë√°nh gi√°‚Ä¶</div>
                    </div>
                    <div class="t-sep"></div>
                    <div class="t-footer"><i class="bi bi-person-circle"></i> Kh√°ch h√†ng</div>
                </article>
            </div>
        </div>

        <button id="revNext" class="t-nav t-next" type="button" aria-label="Sau">
            <i class="bi bi-chevron-right"></i>
        </button>
    </div>
</section>


<!-- CONTACT -->
<section id="contact" class="container">
    <div class="contact-card">
        <div class="d-flex align-items-center justify-content-between flex-wrap gap-2 mb-2">
            <h4 class="m-0 fw-bold">Li√™n h·ªá v·ªõi ch√∫ng t√¥i</h4>
            <small class="text-muted">H·ªó tr·ª£ 8:00‚Äì22:00 m·ªói ng√†y</small>
        </div>
        <div class="row g-3">
            <div class="col-lg-6">
                <div class="mb-1 fw-semibold">S·ªë 1 V√µ VƒÉn Ng√¢n, ƒêH S∆∞ Ph·∫°m Kƒ© Thu·∫≠t, TP.HCM</div>
                <div class="text-muted">UTeaDrink ‚Äì H∆∞∆°ng v·ªã t∆∞∆°i m√°t m·ªói ng√†y</div>
                <div class="mt-2 d-flex flex-wrap gap-2">
                    <a class="btn btn-outline-secondary btn-sm" href="https://maps.google.com/?q=S·ªë 1 V√µ VƒÉn Ng√¢n, Th·ªß ƒê·ª©c" target="_blank" rel="noopener"><i class="bi bi-geo-alt-fill"></i> B·∫£n ƒë·ªì</a>
                    <a class="btn btn-outline-secondary btn-sm" href="tel:0123456789"><i class="bi bi-telephone-fill"></i> 0123 456 789</a>
                    <a class="btn btn-outline-secondary btn-sm" href="mailto:contact@uteadrink.vn"><i class="bi bi-envelope-fill"></i> contact@uteadrink.vn</a>
                </div>
            </div>
            <div class="col-lg-6 d-flex align-items-center justify-content-lg-end">
                <a th:href="@{/login}" class="btn btn-hero"><i class="bi bi-box-arrow-in-right me-1"></i> ƒêƒÉng nh·∫≠p ƒë·ªÉ ƒë·∫∑t h√†ng</a>
            </div>
        </div>
    </div>
</section>

<!-- STORE LOCATOR -->
<section id="map" class="container my-3" th:if="${shops}">
    <div class="locator-card">
        <div class="d-flex align-items-center justify-content-between mb-2">
            <h5 class="m-0 fw-bold">C·ª≠a h√†ng g·∫ßn b·∫°n</h5>
            <small class="text-muted" th:text="|${shops.size()} chi nh√°nh|">0 chi nh√°nh</small>
        </div>
        <div class="row g-3">
            <div class="col-lg-4">
                <div class="store-search">
                    <i class="bi bi-search"></i>
                    <input id="storeSearch" type="text" placeholder="T√¨m theo t√™n, ƒë·ªãa ch·ªâ, qu·∫≠n/huy·ªán‚Ä¶">
                </div>
                <div id="storeList">
                    <div class="store-item" th:each="s, idx : ${shops}"
                         th:attr="data-index=${idx.index}, data-name=${s.name}, data-address=${s.address}, data-phone=${s.phone}"
                         onclick="selectStore(this)">
                        <div class="d-flex justify-content-between">
                            <div class="fw-bold" th:text="${s.name}">Chi nh√°nh</div>
                            <span class="badge text-bg-warning" th:text="${idx.index + 1}">1</span>
                        </div>
                        <div class="text-muted small mt-1">
                            <i class="bi bi-geo-alt"></i> <span th:text="${s.address}">ƒê·ªãa ch·ªâ</span><br>
                            <i class="bi bi-telephone"></i> <span th:text="${s.phone}">SƒêT</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-lg-8">
                <div class="map-card">
                    <iframe id="mapFrame" src="https://www.google.com/maps?q=ƒê·∫°i%20h·ªçc%20S∆∞%20ph·∫°m%20K·ªπ%20thu·∫≠t%20TP.HCM&output=embed" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
                </div>
            </div>
        </div>
    </div>
</section>

<div th:replace="~{fragments/footer-home :: siteFooter}"></div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // T√¨m s·∫£n ph·∫©m nhanh (client-side)
    const productSearch = document.getElementById('productSearch');
    const productGrid = document.getElementById('productGrid');
    if (productSearch && productGrid){
        productSearch.addEventListener('input', ()=>{
            const q = productSearch.value.trim().toLowerCase();
            [...productGrid.children].forEach(item=>{
                const hay = ((item.dataset.name||'') + ' ' + (item.dataset.desc||'')).toLowerCase();
                item.style.display = hay.includes(q) ? '' : 'none';
            });
        });
    }

    // Ch·ªçn c·ª≠a h√†ng + c·∫≠p nh·∫≠t b·∫£n ƒë·ªì
    const storeSearch = document.getElementById('storeSearch');
    const storeListEl = document.getElementById('storeList');
    if (storeSearch && storeListEl) {
        storeSearch.addEventListener('input', () => {
            const q = storeSearch.value.toLowerCase();
            [...storeListEl.querySelectorAll('.store-item')].forEach(item => {
                const hay = (item.dataset.name + ' ' + item.dataset.address + ' ' + item.dataset.phone).toLowerCase();
                item.style.display = hay.includes(q) ? '' : 'none';
            });
        });
    }
    function selectStore(el, scroll = true){
        if(!el) return;

        storeListEl.querySelectorAll('.store-item').forEach(i=>i.classList.remove('active'));
        el.classList.add('active');

        const addr = el.dataset.address || el.dataset.name || '';
        const url  = 'https://www.google.com/maps?q=' + encodeURIComponent(addr) + '&output=embed';
        document.getElementById('mapFrame').setAttribute('src', url);

        if (scroll) {
            const map = document.getElementById('map');
            map && map.scrollIntoView({behavior:'smooth', block:'start'});
        }
    }
    window.addEventListener('DOMContentLoaded', ()=>{
        const first = document.querySelector('#storeList .store-item');
        if (first) selectStore(first, false);
    });
</script>
<script>
    (function(){
        const host   = document.getElementById('testimonials');
        const track  = document.getElementById('revTrack');
        const prev   = document.getElementById('revPrev');
        const next   = document.getElementById('revNext');
        if(!host || !track) return;

        let index = 0;

        function per(){
            const v = getComputedStyle(host).getPropertyValue('--per');
            return Math.max(1, parseInt(v || '3', 10));
        }
        function step(){
            const card = track.querySelector('.t-card');
            if(!card) return 300;
            const gap = parseInt(getComputedStyle(track).gap || '20', 10);
            return Math.round(card.getBoundingClientRect().width + gap);
        }
        function clamp(){
            const total = track.children.length;
            const visible = per();
            if (index < 0) index = 0;
            if (index > total - visible) index = Math.max(0, total - visible);
        }
        function render(){
            clamp();
            const x = index * step();
            track.style.transform = `translateX(-${x}px)`;
            const total = track.children.length;
            const visible = per();
            prev.disabled = index <= 0;
            next.disabled = index >= total - visible;
        }

        prev && prev.addEventListener('click', ()=>{ index -= 1; render(); });
        next && next.addEventListener('click', ()=>{ index += 1; render(); });
        window.addEventListener('resize', ()=>{ render(); });
        render();
    })();
</script>

</body>
</html>
