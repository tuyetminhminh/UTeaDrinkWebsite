<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/admin-layout :: adminLayout(~{::title}, ~{::content})}">

<head>
    <title>UTeaDrink üëë - B·∫£ng ƒëi·ªÅu khi·ªÉn</title>

</head>

<body>
<div class="container-fluid px-4" th:fragment="content">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <section class="dashboard-hero mb-4">
        <div class="headline d-flex flex-wrap justify-content-between align-items-end gap-3">
            <div>
                <h2 class="fw-bold mb-1">üëë Xin ch√†o Qu·∫£n tr·ªã vi√™n UTeaDrink</h2>
                <div class="text-muted">Ch√†o m·ª´ng b·∫°n ƒë·∫øn b·∫£ng ƒëi·ªÅu khi·ªÉn
                    qu·∫£n l√Ω h·ªá th·ªëng.</div>
            </div>
            <!-- Quick actions: CHIPS -->
            <div class="quick d-flex flex-wrap gap-2">
                <a th:href="@{/admin/products/new}" class="action-chip"> <i
                        class="bi bi-plus-circle"></i> Th√™m s·∫£n ph·∫©m
                </a> <a th:href="@{/admin/users}" class="action-chip"> <i
                    class="bi bi-people"></i> Qu·∫£n l√Ω ng∆∞·ªùi d√πng
            </a> <a th:href="@{/admin/shops}" class="action-chip"> <i
                    class="bi bi-shop"></i> C·ª≠a h√†ng
            </a> <a th:href="@{/admin/reports}" class="action-chip"> <i
                    class="bi bi-graph-up-arrow"></i> Th·ªëng k√™
            </a>
            </div>
        </div>
    </section>

    <div class="row g-3 mb-4">
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="kpi">
                <h6>Doanh thu (th√°ng)</h6>
                <div class="val mt-1" th:text="${#numbers.formatDecimal(stats.monthlyRevenue, 1, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="kpi">
                <h6>ƒê∆°n h√†ng (th√°ng)</h6>
                <div class="val mt-1" th:text="${#numbers.formatInteger(stats.monthlyOrders, 3, 'COMMA')}"></div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="kpi">
                <h6>Ng∆∞·ªùi d√πng m·ªõi (th√°ng)</h6>
                <div class="val mt-1" th:text="${stats.newUsersThisMonth}"></div>
            </div>
        </div>
        <div class="col-12 col-sm-6 col-lg-3">
            <div class="kpi">
                <h6>S·∫£n ph·∫©m ƒëang b√°n</h6>
                <div class="val mt-1" th:text="${stats.activeProducts}"></div>
            </div>
        </div>
    </div>

    <div class="row g-3">
        <div class="col-lg-7">
            <div class="card-lite p-3">
                <h5 class="m-0">Doanh thu 30 ng√†y qua</h5>
                <canvas id="revenueChart" class="mt-3"></canvas>
            </div>
        </div>

        <div class="col-lg-5">
            <div class="card-lite p-3 h-100">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="m-0">ƒê∆°n g·∫ßn ƒë√¢y</h5>
                    <a class="btn btn-sm btn-ghost" th:href="@{/admin/orders}">Xem t·∫•t c·∫£</a>
                </div>
                <div class="table-responsive mt-2">
                    <table class="table table-sm align-middle">
                        <thead>
                        <tr>
                            <th>M√£</th>
                            <th>Kh√°ch</th>
                            <th class="text-end">T·ªïng</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr th:each="order : ${stats.recentOrders}">
                            <td th:text="${order.orderCode}"></td>
                            <td th:text="${order.customerName}"></td>
                            <td class="text-end" th:text="${#numbers.formatDecimal(order.total, 1, 'COMMA', 0, 'POINT')} + ' ‚Ç´'"></td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <script th:inline="javascript">
        document.addEventListener("DOMContentLoaded", function() {
            // L·∫•y d·ªØ li·ªáu t·ª´ model
            const labels = /*[[${stats.chartLabels}]]*/ [];
            const data = /*[[${stats.chartData}]]*/ [];

            // QUAN TR·ªåNG: T√¨m ƒë√∫ng th·∫ª canvas theo id
            const ctx = document.getElementById('revenueChart').getContext('2d');

            if (ctx) { // Ch·ªâ v·∫Ω n·∫øu t√¨m th·∫•y canvas
                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: 'Doanh thu (VND)',
                            data: data,
                            borderColor: '#5B93FF',
                            backgroundColor: 'rgba(91, 147, 255, 0.1)',
                            fill: true,
                            tension: 0.3
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: { legend: { display: false } },
                        scales: { y: { beginAtZero: true } }
                    }
                });
            }
        });
    </script>
</div>
</body>
</html>