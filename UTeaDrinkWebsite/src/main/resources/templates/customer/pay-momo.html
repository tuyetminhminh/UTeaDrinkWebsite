<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8"/>
    <title>Thanh toán MoMo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
    <style>
        :root{
            --momo:#a50064;      /* tím MoMo */
            --ink:#0f172a;
            --muted:#6b7280;
            --line:#e9edf1;
            --radius:14px;
        }
        body{background:#f6f7f9;color:var(--ink);font-family:system-ui,-apple-system,'Segoe UI',Roboto}
        .wrap{max-width:1000px;margin:20px auto;padding:0 12px}
        .shell{display:grid;grid-template-columns:320px 1fr;gap:16px}
        @media (max-width: 991.98px){.shell{grid-template-columns:1fr}}

        /* ===== LEFT: panel tím ===== */
        .side{
            background:var(--momo);color:#fff;border-radius:var(--radius);
            min-height:520px;display:flex;flex-direction:column;padding:18px 16px;
        }
        .side .title{font-weight:800;opacity:.95}
        .side .timer{font-size:34px;font-weight:900;margin-top:6px}
        .divider-light{border-color:rgba(255,255,255,.25);margin:12px 0}
        .kv{display:flex;align-items:flex-start;gap:10px;margin:12px 0}
        .kv i{font-size:18px;line-height:1.2;opacity:.9}
        .kv .v{font-weight:700}
        .order-code{font-weight:800;letter-spacing:.3px}
        /* Nút quay lại ở đáy panel */
        .back-btn{
            margin-top:auto;display:inline-flex;align-items:center;gap:6px;
            color:#fff;text-decoration:none;font-weight:700;
            background:rgba(255,255,255,.12);border-radius:999px;padding:8px 12px;
            transition:background .2s,transform .2s;
        }
        .back-btn:hover{background:rgba(255,255,255,.18);transform:translateY(-1px)}

        /* ===== RIGHT: khung QR ===== */
        .qr-panel{background:#fff;border-radius:var(--radius);border:1px solid var(--line);padding:18px}
        .qr-head{display:flex;align-items:center;justify-content:space-between}
        .qr-head img{height:36px}
        .qr-title{font-weight:800;text-align:center;color:var(--momo);margin:10px 0 6px}
        .qr-box{border:1px dashed var(--line);border-radius:12px;padding:14px;text-align:center;background:#fff}
        .qr-img{width:280px;height:280px;object-fit:cover;border-radius:8px;display:block;margin:8px auto}
        .qr-hint{color:var(--muted);font-size:14px}
        .actions{margin-top:14px}
    </style>
</head>
<body>
<div th:replace="~{fragments/header-customer :: customerHeader}"></div>
<div class="wrap">

    <div class="shell">
        <!-- ===== LEFT ===== -->
        <aside class="side">
            <div class="title">Đơn hàng hết hạn sau</div>
            <div id="countdown" class="timer">10:00</div>

            <hr class="divider-light"/>

            <div class="kv">
                <i class="bi bi-building"></i>
                <div>
                    <div class="small" style="opacity:.85">Nhà cung cấp</div>
                    <div class="v">UTeaDrink</div>
                </div>
            </div>

            <div class="kv">
                <i class="bi bi-cash-coin"></i>
                <div>
                    <div class="small" style="opacity:.85">Số tiền</div>
                    <div class="v" th:text="${amount != null} ? ${#numbers.formatDecimal(amount,0,'COMMA',0,'POINT')} + 'đ' : '—'">0đ</div>
                </div>
            </div>

            <div class="kv">
                <i class="bi bi-receipt"></i>
                <div>
                    <div class="small" style="opacity:.85">Thông tin</div>
                    <div class="v">
                        Thanh toán
                        <span th:text="'[' + ${#numbers.formatDecimal(amount,0,'COMMA',0,'POINT')} + 'đ]'">[0đ]</span>
                    </div>
                </div>
            </div>

            <div class="kv">
                <i class="bi bi-hash"></i>
                <div>
                    <div class="small" style="opacity:.85">Đơn hàng</div>
                    <div class="order-code" th:text="${orderCode}">ORD-XXXXXX</div>
                </div>
            </div>

            <hr class="divider-light"/>
            <a th:href="@{/customer/checkout}" class="back-btn">
                <i class="bi bi-arrow-left-short"></i> Quay lại
            </a>
        </aside>

        <!-- ===== RIGHT ===== -->
        <section class="qr-panel">
            <div class="qr-head">
                <img th:src="@{/img/momo.png}" alt="MoMo">
                <img th:src="@{/img/momo.png}" alt="MoMo">
            </div>

            <h5 class="qr-title">Quét mã để thanh toán</h5>

            <div class="qr-box mt-2">
                <!-- QR mẫu từ static/img/momoqr.jpg -->
                <img class="qr-img" th:src="@{/img/momoqr.jpg}" alt="QR MoMo">
                <div class="qr-hint mt-2">
                    <i class="bi bi-qr-code-scan"></i>
                    Sử dụng App <strong>MoMo</strong> hoặc dùng Camera hỗ trợ QR code để quét mã.
                </div>
            </div>

            <!-- Nút giả lập local/dev -->
            <div class="actions">
                <form class="d-inline" th:action="@{|/customer/pay/momo/${orderCode}/success|}" method="post">
                    <button class="btn btn-success">Đã thanh toán thành công</button>
                </form>
                <form class="d-inline ms-2" th:action="@{|/customer/pay/momo/${orderCode}/fail|}" method="post">
                    <button class="btn btn-outline-danger">Thanh toán thất bại / Hủy</button>
                </form>
            </div>

            <div th:if="${error != null}" class="alert alert-danger mt-3 mb-0">
                Thanh toán thất bại. Vui lòng thử lại.
            </div>
        </section>
    </div>
</div>

<script>
    // Đếm ngược 10:00
    (function () {
        var s = 10 * 60, el = document.getElementById('countdown');
        if (!el) return;
        function tick() {
            var m = String(Math.floor(s / 60)).padStart(2, '0');
            var ss = String(s % 60).padStart(2, '0');
            el.textContent = m + ':' + ss;
            if (s > 0) { s--; setTimeout(tick, 1000); } else { el.textContent = 'Hết hạn'; }
        }
        tick();
    })();
</script>
</body>
</html>
