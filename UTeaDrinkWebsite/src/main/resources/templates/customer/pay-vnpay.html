<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="vi">
<head>
    <meta charset="UTF-8"/>
    <title>Thanh toán VNPAY</title>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <style>
        :root{
            --blue:#0b5ed7;            /* màu chủ đạo VNPAY */
            --ink:#0f172a;
            --muted:#6b7280;
            --line:#e9edf1;
            --radius:14px;
        }
        body{background:#f6f7f9;color:var(--ink);font-family:system-ui,-apple-system,'Segoe UI',Roboto}
        .wrap{max-width:1024px;margin:24px auto;padding:0 12px}
        .grid{display:grid;grid-template-columns:340px 1fr;gap:18px}
        @media (max-width:991.98px){ .grid{grid-template-columns:1fr} }

        /* card trái */
        .left{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:18px}
        .left .title{font-weight:900;font-size:20px}
        .left hr{margin:12px 0;border-color:#eff2f5}
        .rowline{display:flex;justify-content:space-between;padding:8px 0}
        .rowline .label{color:var(--muted)}
        .timer{color:var(--blue);font-weight:900}

        /* panel phải */
        .right{background:#fff;border:1px solid var(--line);border-radius:var(--radius);padding:22px}
        .head{display:flex;flex-direction:column;align-items:center;gap:6px}
        .title{font-weight:900;font-size:22px;text-align:center}
        .help{display:inline-flex;align-items:center;gap:6px;font-size:14px}
        .help i{display:inline-block;width:18px;height:18px;line-height:18px;border-radius:50%;
            text-align:center;background:var(--blue);color:#fff;font-style:normal;font-weight:800}
        .vnpay-logo{height:56px}            /* ↑ chỉnh kích thước logo ở đây */

        /* QR + viền góc */
        .qr-wrap{display:flex;flex-direction:column;align-items:center;margin-top:12px}
        .qr-frame{position:relative;padding:14px;border:1px dashed var(--line);border-radius:12px;background:#fff}
        .qr-img{width:280px;height:280px;object-fit:cover;border-radius:8px;display:block}
        .corner{position:absolute;width:44px;height:44px;border:4px solid var(--blue)}
        .tl{top:6px;left:6px;border-right:none;border-bottom:none;border-radius:10px 0 0 0}
        .tr{top:6px;right:6px;border-left:none;border-bottom:none;border-radius:0 10px 0 0}
        .bl{bottom:6px;left:6px;border-right:none;border-top:none;border-radius:0 0 0 10px}
        .br{bottom:6px;right:6px;border-left:none;border-top:none;border-radius:0 0 10px 0}
        .scan{color:var(--blue);text-align:center;margin-top:6px;font-weight:700}

        .actions{display:flex;gap:10px;justify-content:center;margin-top:14px}
    </style>
</head>
<body>
<div th:replace="~{fragments/header-customer :: customerHeader}"></div>
<div class="wrap">

    <div class="grid">
        <!-- LEFT: Thông tin đơn hàng -->
        <aside class="left">
            <div class="title">Thông tin đơn hàng</div>
            <hr>
            <div class="rowline">
                <span class="label">Số tiền thanh toán</span>
                <strong th:text="${#numbers.formatDecimal(amount,0,'COMMA',0,'POINT')} + ' VND'">0 VND</strong>
            </div>
            <div class="rowline">
                <span class="label">Giá trị đơn hàng</span>
                <strong th:text="${#numbers.formatDecimal(amount,0,'COMMA',0,'POINT')} + ' VND'">0 VND</strong>
            </div>
            <div class="rowline">
                <span class="label">Phí giao dịch</span>
                <strong>0<span class="label">VND</span></strong>
            </div>
            <div class="rowline">
                <span class="label">Mã đơn hàng</span>
                <strong th:text="${orderCode}">ORD-XXXX</strong>
            </div>
            <div class="rowline">
                <span class="label">Nhà cung cấp</span>
                <strong>UTeaDrink</strong>
            </div>
            <hr>
            <div class="label">Thời hạn thanh toán</div>
            <div id="countdown" class="timer h4 mt-1">10:00</div>
        </aside>

        <!-- RIGHT: QR -->
        <section class="right">
            <div class="head">
                <div class="title">Quét mã qua ứng dụng Ví VNPAY</div>
                <a class="help text-decoration-none text-muted" href="#" tabindex="-1">
                    <i>i</i> Hướng dẫn thanh toán
                </a>
            </div>

            <div class="qr-wrap">
                <img class="vnpay-logo mt-2" th:src="@{/img/vnpay.png}" alt="VNPAY">
                <div class="qr-frame mt-1">
                    <!-- Ảnh QR thực tế của bạn, nếu có: thay src; không có thì để ảnh mẫu/placeholder -->
                    <img class="qr-img" th:src="@{/img/vnpayqr.jpg}" alt="QR"> <!-- tạm dùng ảnh mẫu -->
                    <span class="corner tl"></span><span class="corner tr"></span>
                    <span class="corner bl"></span><span class="corner br"></span>
                </div>
                <div class="scan">Scan to Pay</div>
            </div>

            <div class="actions">
                <form th:action="@{|/customer/pay/vnpay/${orderCode}/success|}" method="post">
                    <button class="btn btn-success">Đã thanh toán thành công</button>
                </form>
                <form th:action="@{|/customer/pay/vnpay/${orderCode}/fail|}" method="post">
                    <button class="btn btn-outline-danger">Thanh toán thất bại / Hủy</button>
                </form>
            </div>

            <div th:if="${error != null}" class="alert alert-danger mt-3 mb-0">
                Thanh toán thất bại. Vui lòng thử lại.
            </div>
        </section>
    </div>
</div>

<script>
    // đếm ngược 10 phút
    (function () {
        let s = 10 * 60, el = document.getElementById('countdown');
        if (!el) return;
        const tick = () => {
            const m = String(Math.floor(s/60)).padStart(2,'0');
            const ss = String(s%60).padStart(2,'0');
            el.textContent = `${m}:${ss}`;
            if (s>0){ s--; setTimeout(tick, 1000); } else { el.textContent = 'Hết hạn'; }
        };
        tick();
    })();
</script>
</body>
</html>
