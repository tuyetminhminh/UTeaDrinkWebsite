<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
	th:fragment="adminLayout (title, content)">
<head>
<meta charset="UTF-8" />
<title>UTeaDrink Admin</title>

<!-- Title từ trang con -->
<th:block th:replace="${title}"></th:block>

<!-- Bootstrap + Icons -->
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
	rel="stylesheet">

<style>
/* ======= dùng chung token với header ======= */
/* ===== Palette V2: Minimal cam–đen ===== */
:root{ --header-h:64px; }

:root {
	/* Light */
	--bg-body: #f6f7f9;
	--text: #101112;
	--muted: #6b7280;
	--border: rgba(17, 17, 17, .08);
	/* Accent cam */
	--brand: #ff7b00; /* cam chuẩn */
	--brand-ink: #1a1a1a;
	/* Surfaces */
	--surface: #ffffff;
	--surface-2: #fbfbfc;
	/* Header / Card / Sidebar */
	--header-bg: #ffffffcc; /* mờ nhẹ */
	--header-text: #0f1115;
	--elevation: 0 4px 16px rgba(0, 0, 0, .04);
	--card-bg: #fff;
	--card-border: rgba(17, 17, 17, .08);
	--sidebar-bg: #fff;
	--sidebar-border: rgba(17, 17, 17, .08);
	--sidebar-link: #273142;
	--sidebar-active-bg: #0f1115;
	--sidebar-active-fg: #fff;
	/* Hero tinh giản */
	--hero-bg: #fff;
	--hero-text: #0f1115;
}

[data-bs-theme="dark"] {
	/* Dark */
	--bg-body: #0c0d0f;
	--text: #e9eaec;
	--muted: #aeb3bd;
	--border: rgba(255, 255, 255, .12);
	--header-bg: #0c0d0fcc;
	--header-text: #e9eaec;
	--elevation: 0 6px 20px rgba(0, 0, 0, .35);
	--card-bg: #131417;
	--card-border: rgba(255, 255, 255, .10);
	--sidebar-bg: #121316;
	--sidebar-border: rgba(255, 255, 255, .10);
	--sidebar-link: #e4e6eb;
	--sidebar-active-bg: #ff7b00; /* cam nổi bật */
	--sidebar-active-fg: #111;
	--hero-bg: #121316;
	--hero-text: #f5f6f7;
}

/* ===== Surfaces & components ===== */
body {
	background: var(--bg-body);
	color: var(--text)
}

.main-header {
    position: fixed; /* QUAN TRỌNG NHẤT */
    top: 0;
    left: 0;
    right: 0;
    z-index: 1030;
    backdrop-filter: saturate(150%) blur(6px);
    border-bottom: 1px solid var(--border);
    box-shadow: var(--elevation);
}


/* giữ navbar nằm đúng cao */
.navbar{ height:var(--header-h); padding:.55rem 1rem }

.navbar.fixed-top{ z-index:1100; }
html{ scroll-padding-top: var(--header-h); }
.admin-sidebar{
  position: sticky;
  top: calc(var(--header-h) + 12px);
  background: var(--sidebar-bg);
  border: 1px solid var(--sidebar-border);
  border-radius: 14px;
  padding: 10px;
  /* CHÌA KHÓA: cao tối đa = phần còn lại màn hình, cho cuộn riêng */
  max-height: calc(100vh - var(--header-h) - 24px);
  max-width: 280px;  
  overflow: auto;
  scrollbar-gutter: stable;
}

/* 2) Drawer: khi bật class .side-open (bấm nút Danh mục), đổi sidebar thành fixed */
body.side-open .admin-sidebar{
  display: block !important;
  position: fixed;              /* bám theo màn hình */
  top: calc(var(--header-h) + 12px);
  left: 16px;
  bottom: 16px;
  width: min(78vw, 280px);
  z-index: 1050;
  max-height: calc(100vh - var(--header-h) - 28px);
  overflow: auto;
  box-shadow: 0 14px 40px rgba(0,0,0,.25);
}

/* Backdrop mờ khi mở drawer (tạo bằng pseudo của body) */
body.side-open::after{
  content:"";
  position: fixed;
  inset: 0;
  z-index: 1045;
  background: rgba(0,0,0,.25);
  backdrop-filter: blur(1px);
}

.admin-sidebar::-webkit-scrollbar{ width: 8px; }
.admin-sidebar::-webkit-scrollbar-thumb{
  background: rgba(0,0,0,.18);
  border-radius: 999px;
}
[data-bs-theme="dark"] .admin-sidebar::-webkit-scrollbar-thumb{
  background: rgba(255,255,255,.22);
}

.admin-sidebar .section-title {
	font-size: .8rem;
	font-weight: 700;
	color: var(--muted);
	padding: 6px 8px;
	text-transform: uppercase
}

.admin-sidebar .nav-link {
	color: var(--sidebar-link);
	font-weight: 600;
	border-radius: 10px;
	padding: 8px 12px;
	transition: .2s ease
}

.admin-sidebar .nav-link.active {
	background: var(--sidebar-active-bg); /* đã set #ff7b00 ở dark */
	color: var(--sidebar-active-fg); /* #111 ở dark */
	box-shadow: 0 0 0 3px rgba(255, 123, 0, .16);
}

.admin-sidebar .nav-link:active {
	filter: brightness(1.05);
}

.admin-sidebar .nav-link:hover {
	background: rgba(0, 0, 0, .04)
}

[data-bs-theme="dark"] .admin-sidebar .nav-link:hover {
	background: rgba(255, 255, 255, .06)
}

.admin-sidebar .nav-link.active {
	background: var(--sidebar-active-bg);
	color: var(--sidebar-active-fg)
}

.card-lite {
	background: var(--card-bg);
	border: 1px solid var(--card-border);
	border-radius: 16px
}

/* ===== Header buttons ===== */
.icon-btn {
	border: 1px solid var(--border);
	border-radius: 10px;
	padding: .35rem .55rem;
	color: inherit;
	background: transparent;
}

.icon-btn:hover {
	border-color: rgba(255, 123, 0, .45);
	color: var(--brand)
}

/* ===== Hero tinh gọn ===== */
.dashboard-hero {
	background: var(--hero-bg);
	color: var(--hero-text);
	border: 1px solid var(--card-border);
	border-radius: 16px;
	padding: 20px 22px; /* đẩy thoáng, không dồn lên */
}

.dashboard-hero h1 {
	font-weight: 900;
	letter-spacing: -.2px;
	margin: 0 0 6px
}

.dashboard-hero .quick a {
	font-weight: 600;
	text-decoration: none;
	color: var(--brand)
}

.dashboard-hero .quick a:hover {
	text-decoration: underline
}
/* Chips cho quick actions */
.action-chip{
  display:inline-flex; align-items:center; gap:.4rem;
  padding:.45rem .7rem; border-radius:999px; font-weight:700;
  border:1px solid var(--card-border);
  background:transparent;
  color:var(--brand);
  text-decoration:none;
}
.action-chip:hover{ background:rgba(255,123,0,.10); }

[data-bs-theme="dark"] .action-chip{
  border-color:rgba(255,255,255,.16);
  color:#ffc48a;
}
[data-bs-theme="dark"] .action-chip:hover{
  background:rgba(255,123,0,.18);
}

/* ===== KPI tiles ===== */
.kpi {
background: var(--card-bg); /* đổi từ var(--surface) -> var(--card-bg) */
  border: 1px solid var(--card-border);
  border-radius: 14px;
  padding: 12px 14px;
}

.kpi h6 {
	margin: 0;
	color: var(--muted);
	font-weight: 700
}

.kpi .val {
	font-weight: 800;
	font-size: 1.15rem
}
/* Vùng content chuẩn cho mọi trang (tránh Home “tiến lên”) */
main.admin-content {
	padding: 0 16px;
	margin-top: 1.5rem;
} /* bạn đã có */
.container-fluid.p-0, .container-fluid.px-4 {
	margin-top: 0 !important;
}
/* Thêm khoảng đệm đầu section chung một lần */
.section-head {
	margin-top: 8px;
	margin-bottom: 12px;
}

/* Khi có breadcrumb: giấu sidebar, nới rộng content */
body.has-breadcrumbs .admin-sidebar {
	display: none !important;
}

body.has-breadcrumbs main.admin-content {
	padding-left: 0 !important;
}
/* Khi mở drawer, buộc aside hiện ra ở mọi kích thước */
body.side-open aside{
  display: block !important;
}

/* Nút nổi bật/ẩn điều hướng */
.nav-reveal {
	position: fixed;
	left: 16px;
	top: 0;
	margin-top: calc(var(--header-h) + 12px);
	z-index: 1060;
	border: 1px solid var(--border);
	background: var(--surface, #fff);
	border-radius: 999px;
	padding: .4rem .7rem;
	display: flex;
	align-items: center;
	gap: .4rem;
	box-shadow: 0 6px 18px rgba(0, 0, 0, .08);
}

[data-bs-theme="dark"] .nav-reveal {
	background: #181a1f;
}

body:not(.has-breadcrumbs) .nav-reveal {
	display: none;
}
.badge-role {
  font-weight: 700;
  letter-spacing: .3px;
  font-size: .75rem;
  padding: .4rem .55rem;
  border-radius: 8px;
  border: 1px solid var(--border, rgba(0,0,0,.12));
}

.role-admin {
  background-color: #111 !important;
  color: #fff !important;
}
.role-manager {
  background-color: #0f766e !important;
  color: #fff !important;
}
.role-seller {
  background-color: #7c3aed !important;
  color: #fff !important;
}
.role-shipper {
  background-color: #2563eb !important;
  color: #fff !important;
}
.role-customer {
  background-color: #facc15 !important;
  color: #111 !important;
}

/* Dark mode: đảm bảo nhìn vẫn rõ */
[data-bs-theme="dark"] .role-customer {
  background-color: #facc15 !important;
  color: #111 !important;
}

</style>
</head>
<body>

	<!-- Header (đã có toggle theme & active tab theo route) -->
	<div th:replace="~{fragments/header-admin :: header}"></div>
	<div style="height: var(--header-h)"></div>
	<!-- Nút hiện/ẩn sidebar -->
	<button type="button" id="navReveal" class="nav-reveal">
		<i class="bi bi-list"></i> Danh mục
	</button>

	<div class="container-fluid mt-3">
		<div class="row g-3">
			<!-- Sidebar -->
			<aside class="col-lg-2 col-xl-2 d-none d-lg-block">
				<nav class="admin-sidebar">
					<div class="section-title">Điều hướng</div>
					<ul class="nav flex-column">
						<li class="nav-item"><a class="nav-link" href="#"
							th:href="@{/admin/home}" data-route="/admin/home"> <i
								class="bi bi-speedometer2 me-2"></i> Trang chủ
						</a></li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/users}" data-route="/admin/users"> <i
								class="bi bi-people me-2"></i> Người dùng
						</a></li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/shops}" data-route="/admin/shops"> <i
								class="bi bi-shop me-2"></i> Cửa hàng
						</a></li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/categories}" data-route="/admin/categories">
								<i class="bi bi-folder2-open me-2"></i> Danh mục
						</a></li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/products}" data-route="/admin/products"> <i
								class="bi bi-cup-straw me-2"></i> Sản phẩm
						</a></li>
						<li class="nav-item">
						<a class="nav-link" th:href="@{/admin/toppings}" data-route="/admin/toppings">
							<i class="bi bi-plus-square-dotted me-2"></i> Topping
						</a>
						</li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/promotions}" data-route="/admin/promotions">
								<i class="bi bi-stars me-2"></i> Khuyến mãi
						</a></li>
					</ul>

					<div class="section-title mt-2">Giám sát</div>
					<ul class="nav flex-column">
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/moderation}" data-route="/admin/moderation">
								<i class="bi bi-flag me-2"></i> Duyệt nội dung
						</a></li>
						<li class="nav-item"><a class="nav-link"
							th:href="@{/admin/reports}" data-route="/admin/reports"> <i
								class="bi bi-graph-up me-2"></i> Báo cáo
						</a></li>
					</ul>

					
				</nav>
			</aside>
			<!-- Content -->
			<main class="col-12 col-lg-9 col-xl-10 px-3">
				<div class="container-fluid p-0">
					<!-- nội dung trang con -->
					<th:block th:replace="${content}"></th:block>
				</div>
			</main>
		</div>
	</div>

	<script>
    // set active trên sidebar theo đường dẫn
    (function(){
        const path = location.pathname;
        document.querySelectorAll('.admin-sidebar .nav-link[data-route]').forEach(a=>{
            const r = a.getAttribute('data-route')||'';
            if(path.startsWith(r)) a.classList.add('active');
        });
    })();

	(function(){
    const btn = document.getElementById('navReveal');
    const body = document.body;

    // Toggle drawer
    btn?.addEventListener('click', ()=>{
      body.classList.toggle('side-open');
      // Khi dùng drawer, ta bỏ lớp has-breadcrumbs để không ẩn sidebar
      if (body.classList.contains('side-open')){
        body.classList.remove('has-breadcrumbs');
      }
    });

    // Click backdrop để đóng (click vùng tối)
    document.addEventListener('click', (e)=>{
      if (!body.classList.contains('side-open')) return;
      const sidebar = document.querySelector('.admin-sidebar');
      if (!sidebar) return;
      const clickInsideSidebar = sidebar.contains(e.target) || btn.contains(e.target);
      if (!clickInsideSidebar) body.classList.remove('side-open');
    });

    // ESC để đóng
    document.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape') body.classList.remove('side-open');
    });

    // Khi bấm một link trong sidebar -> đóng drawer (đỡ che giao diện)
    document.querySelectorAll('.admin-sidebar a.nav-link').forEach(a=>{
      a.addEventListener('click', ()=> body.classList.remove('side-open'));
    });

    // Giữ behavior cũ: nếu trang có breadcrumbs thì ẩn sidebar (khi không mở drawer)
    const hasBC = !!document.getElementById('bc-flag');
    if (hasBC) body.classList.add('has-breadcrumbs');
  })();
</script>

	<!-- Bootstrap JS -->
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
	
	<!-- Header script (theme toggle) -->
	<div th:replace="~{fragments/header-admin :: headerScript}"></div>
</body>
</html>
