<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/admin-layout :: adminLayout(~{::title}, ~{::content})}">
<head>
  <meta charset="UTF-8">
  <title th:text="${form.id==null? 'Thêm người dùng' : 'Sửa người dùng'}">User</title>
</head>
<body>
<div th:fragment="content" class="container-fluid p-0">

<div th:replace="~{fragments/breadcrumbs ::
  bc('Trang chủ', @{/admin/home}, 'Người dùng', @{/admin/users},
     ${form.id} == null ? 'Thêm' : 'Sửa')}"></div>

  <h3 class="fw-bold mb-3" th:text="${form.id==null? 'Thêm người dùng' : 'Sửa người dùng'}"></h3>

   <form th:object="${form}"
        th:action="${form.id} == null
                    ? @{/admin/users}
                    : @{/admin/users/{id}(id=${form.id})}"  
        method="post" class="row g-3">

    <div th:if="${#fields.hasGlobalErrors()}" class="col-12">
      <div class="alert alert-danger mb-0">
        <ul class="mb-0">
          <li th:each="e : ${#fields.globalErrors()}"
              th:text="${e}">Lỗi</li>
        </ul>
      </div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Email *</label>
      <input class="form-control" th:field="*{email}" >
      <div class="text-danger small" th:errors="*{email}"></div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Username</label>
      <input class="form-control" th:field="*{username}">
      <div class="text-danger small" th:errors="*{username}"></div>
    </div>

    <div class="col-md-4">
      <label class="form-label">Họ tên</label>
      <input class="form-control" th:field="*{fullName}">
    </div>

    <div class="col-md-4">
      <label class="form-label">SĐT</label>
      <input class="form-control" th:field="*{phone}">
    </div>

    <div class="col-md-4">
      <label class="form-label">Ngày sinh</label>
      <input type="date" class="form-control" th:field="*{birthDate}">
    </div>

    <div class="col-md-4">
      <label class="form-label">Trạng thái</label>
      <select class="form-select" th:field="*{status}">
        <option value="ACTIVE">ACTIVE</option>
        <option value="LOCKED">LOCKED</option>
        <option value="PENDING">PENDING</option>
      </select>
    </div>

    <div class="col-md-4" th:if="${form.id==null}">
      <label class="form-label">Mật khẩu *</label>
      <input class="form-control" th:field="*{password}" placeholder="≥ 4 ký tự">
      <div class="text-danger small" th:errors="*{password}"></div>
    </div>
    <div class="col-md-4" th:if="${form.id!=null}">
      <label class="form-label">Mật khẩu mới (để trống nếu giữ nguyên)</label>
      <input class="form-control" th:field="*{password}">
      <div class="text-danger small" th:errors="*{password}"></div>
    </div>

    <div class="col-12">
      <label class="form-label me-3">Vai trò</label>
      <div class="d-flex flex-wrap gap-3">
        <div th:each="r : ${rolesAll}" class="form-check">
          <input class="form-check-input" type="radio" th:id="${'role_'+r.code}"
                 th:value="${r.code}" th:field="*{roleCode}">
          <label class="form-check-label" th:for="${'role_'+r.code}" th:text="${r.code}"></label>
        </div>
      </div>
      <div class="text-danger small" th:errors="*{roleCode}"></div>
    </div>

    <div class="col-12 d-flex gap-2">
      <a class="btn btn-outline-secondary" th:href="@{/admin/users}">Hủy</a>
      <button class="btn btn-primary">Lưu</button>
    </div>
  </form>
</div>
</body>
</html>
